# 媒体文件重复清理工具详细使用说明

## 功能简介

这是一个专门用于查找和清理重复媒体文件的工具，支持智能检测和处理图片及视频文件。该工具能够分析文件名、大小、视频时长、帧率等信息，自动识别重复内容，并智能选择保留最适合的文件，删除其余副本，帮助整理媒体文件库并释放磁盘空间。

## 主要特点

- **智能识别重复媒体**：支持图片和视频格式
- **深度视频分析**：使用ffprobe提取视频元数据（时长、帧率）精确判断重复
- **智能保留策略**：自动选择最适合保留的文件（通常是原始文件）
- **详细操作日志**：记录所有扫描和删除操作，便于追踪
- **交互式确认**：删除前显示详细信息并要求确认，防止误删

## 系统要求

- Python 3.6或更高版本
- FFmpeg（用于视频分析）
- Windows/Mac/Linux系统

## 安装依赖

使用前请确保已安装FFmpeg并将其添加到系统路径中，这是分析视频文件所必需的。

## 命令行用法

```
python media_duplicate_cleaner.py <根目录路径>
```

### 参数说明：
- `<根目录路径>`：要扫描的根目录，工具将递归扫描此目录下的所有子目录

## 支持的文件格式

### 图片格式
- JPG/JPEG
- PNG
- GIF
- BMP
- WebP

### 视频格式
- MP4
- MKV
- AVI
- MOV
- WMV
- FLV
- WebM

## 重复文件检测逻辑

### 图片文件
- 主要通过文件名模式匹配，识别形如"文件名(1).jpg"的命名
- 当原始文件（无括号序号）和带序号文件同时存在时，认为是重复

### 视频文件
- 首先通过文件大小进行初步分组
- 然后使用FFmpeg提取视频的时长和帧率信息
- 当大小、时长和帧率都接近时，认为是同一视频的不同副本
- 在重复组中，优先保留：
  1. 文件名最短的（通常是原始文件）
  2. 修改时间最早的
  3. 如果以上条件相同，则保留列表中的第一个

## 使用流程

1. **扫描阶段**：
   - 工具会递归扫描指定目录及其所有子目录
   - 对每个包含媒体文件的目录进行处理
   - 收集潜在的重复文件信息

2. **显示阶段**：
   - 按目录显示找到的重复文件
   - 图片和视频分开显示，便于区分
   - 视频文件按重复组显示，包含大小、时长和帧率信息

3. **确认阶段**：
   - 显示所有要删除的文件后，要求用户确认
   - 只有输入"y"才会执行删除操作

4. **删除阶段**：
   - 执行删除操作，并实时显示进度
   - 记录删除成功和失败的情况

5. **日志记录**：
   - 所有操作都记录到日志文件
   - 日志文件保存在当前目录，命名格式为`delete_operation_日期_时间.log`

## 使用示例

```bash
# 扫描并清理我的图片目录
python media_duplicate_cleaner.py D:\我的图片

# 扫描并清理我的视频收藏
python media_duplicate_cleaner.py "E:\电影收藏"
```

## 操作界面示例

执行脚本后，会看到类似以下输出：

```
开始处理目录: D:\媒体文件
扫描目录: 153

找到 287 个需要删除的重复文件

========================================================
目录: D:\媒体文件\度假照片
删除文件数: 23
========================================================

📷 图片文件 (23个):
  1. 海滩照片(1).jpg (图片: 3.45MB)
  2. 家庭合影(1).jpg (图片: 5.12MB)
  ...

========================================================
目录: D:\媒体文件\电影
删除文件数: 5
========================================================

🎬 视频文件 (5个):

  重复组 1 - 大小: 1524.36MB, 时长: 120.35s, 帧率: 24.00fps
  ├─ 删除文件 (2个):
  ├─ 1. 电影名称(1).mp4
  └─ 2. 电影名称 副本.mp4

  重复组 2 - 大小: 853.12MB, 时长: 95.67s, 帧率: 30.00fps
  ├─ 删除文件 (3个):
  ├─ 1. 视频片段【1】.mp4
  ├─ 2. 视频片段(2).mp4
  └─ 3. 视频片段_3.mp4
  
总计要删除 287 个重复文件
确定要删除上述所有文件吗？(y/N): 
```

## 注意事项

1. **首次使用**：建议先在测试目录上运行，熟悉工具的工作方式
2. **备份重要数据**：虽然工具设计为安全操作，但在处理重要数据前请先备份
3. **FFmpeg依赖**：确保已安装FFmpeg并添加到系统路径，否则视频分析功能将不可用
4. **权限问题**：确保对要扫描的目录有读写权限
5. **大型目录**：处理大量文件时，扫描过程可能需要较长时间，请耐心等待
6. **不可撤销**：删除操作执行后无法撤销，请仔细检查确认信息

## 故障排除

1. **"无法创建日志文件"错误**：
   - 检查当前目录的写入权限
   - 尝试以管理员权限运行脚本

2. **"FFmpeg相关错误"**：
   - 确保FFmpeg已正确安装
   - 检查系统环境变量是否包含FFmpeg路径

3. **扫描速度过慢**：
   - 大量视频文件分析需要时间，属于正常现象
   - 考虑分批处理较小的目录

4. **删除失败**：
   - 查看日志文件了解具体原因
   - 常见原因包括文件被占用、权限不足等

通过本工具，您可以轻松整理媒体库，消除冗余文件，保持文件系统的整洁与高效。 